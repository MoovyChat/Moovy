import{w as ge,r,u as ve,Q as Ne,i as W,a4 as fe,a as s,j as t,C as ke,a5 as Ee,R as Q,t as Ce,b as S,c as P,s as w,d as g,p as v}from"./index.js";import{f as Me,g as Ie,h as Se,i as Pe,j as we,k as be,l as Te,m as ye}from"./index.esm.ts";import{P as Le,b as xe,c as q}from"./helpers.ts";import{u as De,a as He}from"./hooks.ts";import _e from"./childHeader.ts";import{C as Fe}from"./commentButton.ts";import{C as Oe}from"./commentThread.styles.ts";import Be from"./emptyPage.ts";import{P as ze,F as $e}from"./tooltip.ts";import{H as Ue}from"./Helmet.ts";import{I as b}from"./image.ts";import Ae from"./logoLoading.ts";import{M as je}from"./miniCommentCard.ts";import{S as We,M as G}from"./movieInfo.ts";import{R as Qe}from"./replyCard.ts";import{u as qe}from"./cardTemplate.ts";const Ge=({type:h,comment:a,replies:d,userRef:l,like:Y,fetchMore:V,likesCount:J,likedUsers:K,updateLike:X})=>{var F,O,B,z,$,U,A,j;const u=r.useRef(null),c=De(),N=ve(),[T]=Ne({variables:{mid:a==null?void 0:a.movieId},pause:W()}),[n,Z]=r.useState(null),[o,R]=r.useState(null),[ee,se]=r.useState(""),p=r.useRef(null),y=He(e=>e.user),[f,L]=r.useState(!1),[k,x]=r.useState(!1),E=!!(a!=null&&a.parentCommentId),[ae,D]=r.useState(!1),[C,te]=r.useState(!1),[oe,ie]=r.useState(""),[H,_]=r.useState(!1),[M]=fe({variables:{getTitleInfoId:ee},pause:W()});r.useEffect(()=>{var e;u&&((e=u.current)==null||e.scrollIntoView())},[u.current]),r.useEffect(()=>{const{data:e,error:i,fetching:I}=T;if(i&&console.log(i),!I&&e){const m=e.getMovie;Z(()=>m),se(()=>m.titleId)}},[T]),r.useEffect(()=>{const{data:e,fetching:i,error:I}=M;if(!i&&e){const m=e.getTitleInfo;R(()=>m)}},[M]);const ne=e=>{e.stopPropagation();const i=e.target;i.scrollHeight-i.scrollTop-2<=i.clientHeight&&V()},re=e=>{e.stopPropagation(),L(!0)},le=e=>{e.stopPropagation(),L(!1)},ce=e=>{e.stopPropagation(),x(!0)},de=e=>{e.stopPropagation(),x(!1)};r.useEffect(()=>{if(!p||!p.current)return;const{clientHeight:e,scrollHeight:i}=p.current;ie(()=>`${i}px`),e<i?D(()=>!0):D(()=>!1)},[p.current]);const pe=e=>{e.stopPropagation(),S.unstable_batchedUpdates(()=>{c(P(!0)),c(w(a)),h==="comment"?c(g(v.DELETE_COMMENT)):h==="reply"&&c(g(v.DELETE_REPLY)),_(()=>!1)})},he=e=>{e.stopPropagation();const i={data:K,type:"Liked"};S.unstable_batchedUpdates(()=>{c(w(i)),c(P(!0)),c(g(v.OPEN_FOLLOW))})},ue=e=>{e.stopPropagation(),S.unstable_batchedUpdates(()=>{c(P(!0)),c(g(v.ADD_REPLY)),c(w(a))})};let me=qe(a.message);return M.fetching?s(Ae,{}):t(Oe,{cardHeight:oe,showMore:C,showEpisodeInfo:f,showTitleInfo:k,isReply:E,movieBg:n==null?void 0:n.stills,titleBg:o==null?void 0:o.boxart,children:[t(Ue,{children:[s("title",{children:o==null?void 0:o.title}),s("meta",{name:"description",content:a.message}),s("link",{rel:"canonical",href:`${ke}/${E?"reply":"comment"}/${a.id}`})]}),s(_e,{className:"comment-header",text:h.charAt(0).toUpperCase()+h.slice(1)}),t("div",{className:"main-container",onScroll:ne,children:[E&&s(je,{className:"cc",id:a==null?void 0:a.parentReplyId,type:(a==null?void 0:a.parentCommentId)===(a==null?void 0:a.parentReplyId)?"comment":"reply",extendData:!0}),s("div",{className:"comment-container",ref:u,children:t("div",{className:"inner",children:[t("div",{className:"comment-usr-detail",children:[t("div",{className:"user-container",children:[s("div",{className:"user",children:s(ze,{src:(F=l.current)==null?void 0:F.photoUrl,user:l.current,tooltip:!0})}),s("div",{className:"name",children:(O=l.current)==null?void 0:O.nickname})]}),t("div",{className:"options-container",children:[((B=l.current)==null?void 0:B.nickname)!==y.nickname&&l&&l.current&&s($e,{userId:(z=l.current)==null?void 0:z.id,nickName:($=l.current)==null?void 0:$.nickname}),t("div",{className:"option",children:[s("div",{className:"option-icon",onClick:e=>{e.stopPropagation(),_(()=>!H)},children:s(Me,{className:"icon",size:20})}),H&&t("div",{className:"option-window",children:[((U=l.current)==null?void 0:U.nickname)===y.nickname&&t("div",{className:"opo delete",onClick:pe,children:[s("div",{className:"opo-icon",children:s(Ie,{size:20})}),s("div",{className:"opo-text",children:"Delete"})]}),t("div",{className:"opo",style:{pointerEvents:"none",opacity:"0.5"},children:[s("div",{className:"opo-icon",children:s(Se,{size:20})}),s("div",{className:"opo-text",children:"Flag this comment (Beta)"})]}),t("div",{className:"opo",style:{pointerEvents:"none",opacity:"0.5"},children:[s("div",{className:"opo-icon",children:s(Pe,{size:20})}),t("div",{className:"opo-text",children:["Block @",(A=l.current)==null?void 0:A.nickname," (Beta)"]})]}),t("div",{className:"opo",style:{pointerEvents:"none",opacity:"0.5"},children:[s("div",{className:"opo-icon",children:s(we,{size:20})}),t("div",{className:"opo-text",children:["Report @",(j=l.current)==null?void 0:j.nickname," (Beta)"]})]})]})]})]})]}),t("div",{className:"comment-usr-msg",children:[s("div",{className:"cm-us-xt",ref:p,children:me.map((e,i)=>e.type===Ee.SPOILER?s(We,{children:e.message},i):s(Q.Fragment,{children:t("span",{className:e.type,onClick:I=>{e.type==="user"&&N(`/profile/${e.message.slice(1)}`)},children:[Le(e.message)," "]},i)},i))}),ae&&s("div",{className:"show-more",onClick:e=>{e.stopPropagation(),te(!C)},children:C?"Show less":"Show more"})]}),s("div",{className:"comment-usr-time",children:xe(a==null?void 0:a.createdAt)}),t("div",{className:"movie-chips",children:[o&&(o==null?void 0:o.type)==="show"&&s(Q.Fragment,{children:t("div",{className:"name title",onMouseEnter:ce,onMouseLeave:de,onClick:e=>{e.stopPropagation(),N(`/show/${o==null?void 0:o.id}`)},children:[o==null?void 0:o.title," ",n==null?void 0:n.season]})}),s("div",{className:"name",onMouseEnter:re,onMouseLeave:le,onClick:e=>{e.stopPropagation(),N(`/movie/${n==null?void 0:n.id}`)},children:n==null?void 0:n.name})]}),t("div",{className:"show-details",children:[s("div",{className:"bg",children:f?s(b,{src:n==null?void 0:n.stills,alt:"background-image"},"episode"):k?s(b,{src:o==null?void 0:o.artwork,alt:"background-image"},"title"):s(b,{src:"https://png.pngtree.com/thumb_back/fh260/background/20210316/pngtree-black-abstract-fluorescent-line-background-image_587942.jpg",alt:"background-image"})}),f?s(G,{movie:n}):k&&s(G,{title:o})]}),t("div",{className:"comment-usr-stats",children:[t("div",{className:"likes cus",children:[s("span",{className:"icon",onClick:X,children:Y?s(be,{size:20,fill:"#ff005d"}):s(Te,{size:20})}),t("span",{className:"count",onClick:he,children:[q(J)," Likes"]})]}),t("div",{className:"comment cus",children:[s("span",{className:"icon",onClick:ue,children:s(ye,{size:20})}),t("span",{className:"count",children:[q(a==null?void 0:a.repliesCount)," Replies"]})]})]}),s("div",{className:"comment-replies",children:(d==null?void 0:d.length)>0?d==null?void 0:d.map(e=>s(Qe,{comment:e,isMain:!0},`reply${e==null?void 0:e.id}`)):s("div",{className:"no-data",children:s(Be,{msg:"No Replies yet"})})})]})}),s(Fe,{type:"comment",data:a})]})]})},cs=ge(Ce)(Ge);export{cs as C};
