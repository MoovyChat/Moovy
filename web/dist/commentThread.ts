import{k as U,r as s,G as T,_ as F,w as N,e as j,l as A,m as B,n as D,o as O,q as z,a as q,i as v,t as H}from"./index.js";import{C as J}from"./commentTemplate.ts";import K from"./loading.ts";import V from"./notFound.ts";import{a as W}from"./hooks.ts";import"./index.esm.ts";import"./iconBase.ts";import"./helpers.ts";import"./childHeader.ts";import"./styled-components.browser.esm.ts";import"./commentThread.styles.ts";import"./commentButton.ts";import"./emptyPage.ts";import"./CSSTransition.ts";import"./inheritsLoose.ts";import"./tooltip.ts";import"./image.ts";import"./moovy-white.ts";import"./Helmet.ts";import"./logoLoading.ts";import"./moovy-text-logo-white.ts";import"./splashScreen.styles.ts";import"./miniCommentCard.ts";import"./movieInfo.ts";import"./replyCard.ts";import"./cardTemplate.ts";import"./loading.styles.ts";const X=(r,L,t,l,c)=>{const p=U();return{fetchMore:s.useCallback(()=>{var C;const{pageInfo:d}=((C=t==null?void 0:t.data)==null?void 0:C.getCommentReplies)||{};!(t!=null&&t.data)||!(d!=null&&d.hasNextPage)||p.query(T,{first:5,after:l,cid:r==null?void 0:r.id}).toPromise().then(R=>{const{data:M,error:G}=R,k=M.getCommentReplies,g=k.pageInfo;c(()=>g.endCursor);const S=k.nodes;L(m=>F.chain(m).concat(S).uniqBy("id").value())})},[t])}},Y=()=>{const{id:r}=j();s.useEffect(()=>{document.title="Comment - Moovy"},[]);const L=s.useRef(null),t=W(e=>e.user),[l,c]=s.useState(!1),[p,f]=s.useState(0),[d,C]=s.useState([]),[R,M]=s.useState(""),[G,k]=s.useState([]),[g]=A({variables:{cid:r},pause:v()}),[S]=B({variables:{cid:r},pause:v()}),[m,x]=s.useState(),[,w]=D(),[b,Z]=O({variables:{cid:r,limit:10,page:1},pause:v()});s.useEffect(()=>{var n,a;const{data:e,fetching:i,error:o}=b;if(o&&console.log(o),!i&&e){const Q=(n=e.getCommentLikes)==null?void 0:n.likesCount,u=(a=e.getCommentLikes)==null?void 0:a.likes,h=u==null?void 0:u.find(y=>y.id===t.id);c(!!h),k(u),f(Q)}},[b.fetching]),s.useMemo(()=>{const{data:e,fetching:i,error:o}=g;if(o&&console.log(o),!i&&e){const n=e.getComment,a=e.getComment.likesCount;f(()=>a),x(()=>n)}},[g]),s.useMemo(()=>{const{data:e,error:i,fetching:o}=S;if(i&&console.log(i),!o&&e){const n=e.getCommentedUser;L.current=n}},[S]);const[_]=z({variables:{cid:r,first:5,after:R},pause:v()});s.useEffect(()=>{const{error:e,data:i,fetching:o}=_;if(e&&console.log(e),!o&&i){const a=i.getCommentReplies.nodes;C(()=>a)}},[_]);const{fetchMore:E}=X(m,C,_,R,M),P=async e=>{var Q;e.stopPropagation(),c(!l),f(l?p-1:p+1);const i=await w({uid:t==null?void 0:t.id,cid:r,like:!l,mid:m==null?void 0:m.movieId}),{data:o,error:n}=i;n&&console.log(n);const a=(Q=o==null?void 0:o.setCommentLike)==null?void 0:Q.likeStatus.like;c(a),k(u=>{let h=[];return a?h=[...u,t]:h=u.filter(y=>(y==null?void 0:y.id)!==(t==null?void 0:t.id)),h})};return g.fetching?q(K,{}):m?q(J,{type:"comment",userRef:L,replies:d,comment:m,like:l,fetchMore:E,setLike:c,likesCount:p,likedUsers:G,updateLike:P}):q(V,{})},Me=N(H)(Y);export{Me as default};
