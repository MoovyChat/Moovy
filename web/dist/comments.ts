import{k as C,r as m,v as g,_ as x,w as v,e as U,x as N,a as s,j as h,C as R,i as T,t as E}from"./index.js";import{C as O}from"./commentCard.ts";import{C as P}from"./comments.styles.ts";import q from"./emptyPage.ts";import{H as y}from"./Helmet.ts";import M from"./loading.ts";import{V as S}from"./index.ts";import"./cardTemplate.ts";import"./movieInfo.ts";import"./index.esm.ts";import"./iconBase.ts";import"./styled-components.browser.esm.ts";import"./helpers.ts";import"./hooks.ts";import"./image.ts";import"./moovy-white.ts";import"./tooltip.ts";import"./CSSTransition.ts";import"./inheritsLoose.ts";import"./loading.styles.ts";const w=(r,f,o)=>{const c=C();return{fetchMore:m.useCallback(()=>{var a;const{pageInfo:e}=((a=o==null?void 0:o.data)==null?void 0:a.getCommentsOfTheUser)||{};!(o!=null&&o.data)||!(e!=null&&e.hasNextPage)||c.query(g,{first:10,after:e==null?void 0:e.endCursor,uid:r}).toPromise().then(l=>{const{data:t,error:n}=l;console.log(l);const i=t==null?void 0:t.getCommentsOfTheUser;i==null||i.pageInfo;const u=i==null?void 0:i.nodes;f(d=>x.chain(d).concat(u).uniqBy("id").value())})},[o])}},H=()=>{const{id:r}=U(),f=m.useRef(null),o=m.useRef(null);m.useState("");const[c,p]=m.useState([]);m.useEffect(()=>{document.title="Comments - Moovy"},[]);const[e]=N({variables:{uid:r,first:10,after:""},pause:T()&&!r});m.useEffect(()=>{const{fetching:t,data:n}=e;if(!t&&n){const u=n.getCommentsOfTheUser.nodes;p(u)}},[e]);const a=t=>{t.stopPropagation();const n=t.target;n.scrollHeight-n.scrollTop-2<=n.clientHeight&&(console.log("fetching more"),l())},{fetchMore:l}=w(r,p,e);return c.length<=0?s(q,{msg:"No Comments!"}):h(P,{className:"comments",children:[h(y,{children:[s("title",{children:`${r}: Comments`}),s("meta",{name:"description",content:`${r} comments`}),s("link",{rel:"canonical",href:`${R}/comments/${r}`})]}),s(m.Fragment,{children:h("div",{className:"child",ref:o,onScroll:a,children:[s(S,{ref:f,viewportRef:o,items:c,children:(t,n)=>t&&s(O,{comment:t},t.id)}),s("div",{className:"extra",children:e.fetching&&s(M,{})})]})})]})},I=v(E,{ssr:!0})(H);export{I as default};
