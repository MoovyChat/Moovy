import{k as T,r as t,Z as _,_ as F,w as N,e as j,$ as A,a0 as B,a1 as D,a2 as Z,a3 as $,a as O,i as C,t as z}from"./index.js";import{C as H}from"./commentTemplate.ts";import J from"./loading.ts";import K from"./notFound.ts";import{a as V}from"./hooks.ts";import"./index.esm.ts";import"./iconBase.ts";import"./helpers.ts";import"./childHeader.ts";import"./styled-components.browser.esm.ts";import"./commentThread.styles.ts";import"./commentButton.ts";import"./emptyPage.ts";import"./CSSTransition.ts";import"./inheritsLoose.ts";import"./tooltip.ts";import"./image.ts";import"./moovy-white.ts";import"./Helmet.ts";import"./logoLoading.ts";import"./moovy-text-logo-white.ts";import"./splashScreen.styles.ts";import"./miniCommentCard.ts";import"./movieInfo.ts";import"./replyCard.ts";import"./cardTemplate.ts";import"./loading.styles.ts";const W=(n,R,o,u,a)=>{const L=T();return{fetchMore:t.useCallback(()=>{var p;const{pageInfo:c}=((p=o==null?void 0:o.data)==null?void 0:p.getRepliesOfReply)||{};!(o!=null&&o.data)||!(c!=null&&c.hasNextPage)||L.query(_,{first:5,after:u,rid:n==null?void 0:n.id}).toPromise().then(y=>{const{data:f,error:b}=y;console.log(f);const l=f==null?void 0:f.getRepliesOfReply,m=l==null?void 0:l.pageInfo;a(()=>m==null?void 0:m.endCursor);const q=l==null?void 0:l.nodes;R(Q=>F.chain(Q).concat(q).uniqBy("id").value())})},[o])}},X=()=>{const{id:n}=j();t.useEffect(()=>{document.title="Reply - Moovy"},[]);const R=t.useRef(null),o=V(e=>e.user);t.useState(1);const[u,a]=t.useState(!1),[L,S]=t.useState([]),[c,p]=t.useState(0),[y,f]=t.useState(""),[b,l]=t.useState([]),[m,q]=A({variables:{rid:n,limit:10,page:1},pause:C()}),[,Q]=B(),[v]=D({variables:{rid:n},pause:C()}),[x]=Z({variables:{rid:n},pause:C()}),[E]=$({variables:{rid:n,first:5,after:y},pause:C()}),[d,G]=t.useState(null);t.useEffect(()=>{var i,k;const{data:e,fetching:r,error:s}=m;if(s&&console.log(s),!r&&e){const g=(i=e.getReplyLikes)==null?void 0:i.likesCount,h=(k=e.getReplyLikes)==null?void 0:k.likes,P=h==null?void 0:h.find(w=>w.id===o.id);a(!!P),l(h),p(g)}},[m.fetching]),t.useEffect(()=>{const{data:e,fetching:r,error:s}=v;if(s&&console.log(s),!r&&e){const i=e.getReply;G(()=>i)}},[v]),t.useEffect(()=>{const{data:e,error:r,fetching:s}=x;if(r&&console.log(r),!s&&e){const i=e.getRepliedUser;R.current=i}},[x]),t.useEffect(()=>{const{data:e,error:r,fetching:s}=E;if(r&&console.log(r),!s&&e){const i=e.getRepliesOfReply;S(()=>i.nodes),console.log(i)}},[E]);const{fetchMore:M}=W(d,S,E,y,f),U=async e=>{var g;e.stopPropagation(),a(!u),p(u?c-1:c+1);const r=await Q({uid:o==null?void 0:o.id,rid:n,like:!u,mid:d==null?void 0:d.movieId}),{data:s,error:i}=r;i&&console.log(i);const k=(g=s==null?void 0:s.setReplyLike)==null?void 0:g.likeStatus.like;a(k)};return v.fetching?O(J,{}):d?O(H,{type:"reply",userRef:R,comment:d,replies:L,like:u,setLike:a,fetchMore:M,likesCount:c,likedUsers:b,updateLike:U}):O(K,{})},Ee=N(z)(X);export{Ee as default};
